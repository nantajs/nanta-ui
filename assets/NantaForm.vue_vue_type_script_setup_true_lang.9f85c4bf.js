import{b as Ee,i as U,c as Me,t as Ve,a as ke,d as $e,w as be,R as De,C as _e,e as Be,f as je,g as qe,h as Ne,j as Oe,k as D,l as z,u as s,m as ne,n as J,o as ye,p as Re,q as N,r as Le,s as We,v as Y,x as re,y as x,z as Ue,D as Ke,F as Ce,A as He,_ as Ye,B as Pe,E as ze,G as Je,H as Ge,I as Ze,J as Qe,K as de,L as Xe,M as se,N as me,O as Q,P as X,Q as et,S as oe,T as he,U as ee,V as te,W as tt,X as nt,Y as rt,Z as st,$ as pe}from"./useModal.a1e0be06.js";import{b as ot}from"./useForm.f13971f1.js";function at(e,n,l){var h=e.length;return l=l===void 0?h:l,!n&&l>=h?e:Ee(e,n,l)}var it="\\ud800-\\udfff",lt="\\u0300-\\u036f",ct="\\ufe20-\\ufe2f",ft="\\u20d0-\\u20ff",ut=lt+ct+ft,dt="\\ufe0e\\ufe0f",mt="\\u200d",ht=RegExp("["+mt+it+ut+dt+"]");function Se(e){return ht.test(e)}function pt(e){return e.split("")}var we="\\ud800-\\udfff",gt="\\u0300-\\u036f",bt="\\ufe20-\\ufe2f",yt="\\u20d0-\\u20ff",Rt=gt+bt+yt,Ct="\\ufe0e\\ufe0f",Pt="["+we+"]",ie="["+Rt+"]",le="\\ud83c[\\udffb-\\udfff]",St="(?:"+ie+"|"+le+")",Ae="[^"+we+"]",Ie="(?:\\ud83c[\\udde6-\\uddff]){2}",ve="[\\ud800-\\udbff][\\udc00-\\udfff]",wt="\\u200d",Fe=St+"?",xe="["+Ct+"]?",At="(?:"+wt+"(?:"+[Ae,Ie,ve].join("|")+")"+xe+Fe+")*",It=xe+Fe+At,vt="(?:"+[Ae+ie+"?",ie,Ie,ve,Pt].join("|")+")",Ft=RegExp(le+"(?="+le+")|"+vt+It,"g");function xt(e){return e.match(Ft)||[]}function Tt(e){return Se(e)?xt(e):pt(e)}function Et(e,n,l,h){if(!U(e))return e;n=Me(n,e);for(var p=-1,d=n.length,P=d-1,f=e;f!=null&&++p<d;){var I=Ve(n[p]),E=l;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(p!=P){var y=f[I];E=h?h(y,I,f):void 0,E===void 0&&(E=U(y)?y:ke(n[p+1])?[]:{})}$e(f,I,E),f=f[I]}return e}const Mt=be(De),ge=be(_e);var Vt="[object Number]";function Te(e){return typeof e=="number"||Be(e)&&je(e)==Vt}function kt(e){return function(n){n=qe(n);var l=Se(n)?Tt(n):void 0,h=l?l[0]:n.charAt(0),p=l?at(l,1).join(""):n.slice(1);return h[e]()+p}}var $t=kt("toUpperCase");const Dt=$t;function _t(e){return e===null}function fe(e,n,l){return e==null?e:Et(e,n,l)}function Bt(e,n){return e&&e.length?ot(e,Ne(n)):[]}function jt(e,n){return e&&["Input","InputPassword","InputSearch","InputTextArea"].includes(e)&&n&&Te(n)?`${n}`:n}const qt=["DatePicker","MonthPicker","WeekPicker","TimePicker"];function Nt(){return[...qt,"RangePicker"]}const Ot=Nt();function Lt(e){return e&&Ot.includes(e)}const ce=Oe;function Wt(e,n,l){const h=/^\[(.+)\]$/;if(h.test(e)){const p=e.match(h);if(p&&p[1]){const d=p[1].split(",");return n=Array.isArray(n)?n:[n],d.forEach((P,f)=>{fe(l,P.trim(),n[f])}),!0}}}function Ut(e,n,l){const h=/^\{(.+)\}$/;if(h.test(e)){const p=e.match(h);if(p&&p[1]){const d=p[1].split(",");return n=U(n)?n:{},d.forEach(P=>{fe(l,P.trim(),n[P.trim()])}),!0}}}function Kt(e,n){if(!n||!Array.isArray(n))return e;for(const[l,[h,p],d="YYYY-MM-DD"]of n){if(!l||!h||!p||!e[l])continue;const[P,f]=e[l];e[h]=ce(P).format(d),e[p]=ce(f).format(d),Reflect.deleteProperty(e,l)}return e}const Ht=["Input","InputPassword","InputSearch","InputTextArea"];function Yt(e,n="default",l){if(!e||!Reflect.has(e,n))return null;if(!D(e[n]))return console.error(`${n} is not a function!`),null;const h=e[n];return h?h(l):null}function zt({getProps:e,formModel:n,getSchema:l,defaultValueRef:h,formElRef:p,schemaRef:d,handleFormValues:P,getFieldsValue:f,setFieldsValue:I}){async function E(t){const c=z(s(l));if(!t)return;let i=ne(t)?[t]:t;ne(t)&&(i=[t]);for(const o of i)y(o,c);d.value=c}function y(t,c){if(ne(t)){const i=c.findIndex(o=>o.field===t);i!==-1&&(delete n[t],c.splice(i,1))}}async function T(t,c,i=!1){const o=z(s(l)),a=o.findIndex(v=>v.field===c);if(!c||a===-1||i){i?o.unshift(t):o.push(t),d.value=o,M(t);return}a!==-1&&o.splice(a+1,0,t),M(t),d.value=o}async function K(t){let c=[];if(U(t)&&c.push(t),J(t)&&(c=[...t]),!c.every(o=>o.component==="Divider"||Reflect.has(o,"field")&&o.field)){console.error("All children of the form Schema array that need to be updated must contain the `field` field");return}d.value=c}async function L(t){let c=[];if(U(t)&&c.push(t),J(t)&&(c=[...t]),!c.every(a=>a.component==="Divider"||Reflect.has(a,"field")&&a.field)){console.error("All children of the form Schema array that need to be updated must contain the `field` field");return}const o=[];c.forEach(a=>{s(l).forEach(v=>{if(v.field===a.field){const A=ye(v,a);o.push(A)}else o.push(v)})}),M(o),d.value=Bt(o,"field")}function M(t){let c=[];U(t)&&c.push(t),J(t)&&(c=[...t]);const i={},o=f();c.forEach(a=>{a.component!="Divider"&&Reflect.has(a,"field")&&a.field&&!Re(a.defaultValue)&&!(a.field in o)&&(i[a.field]=a.defaultValue)}),I(i)}async function m(t,c){var i;await((i=s(p))==null?void 0:i.scrollToField(t,c))}return{updateSchema:L,resetSchema:K,appendSchemaByField:T,removeSchemaByFiled:E,scrollToField:m}}function Jt(e,n){return N(()=>{const l=s(e),{labelCol:h={},wrapperCol:p={}}=l.itemProps||{},{labelWidth:d,disabledLabelWidth:P}=l,{labelWidth:f,labelCol:I,wrapperCol:E,layout:y}=s(n);if(!f&&!d&&!I||P)return h.style={textAlign:"left"},{labelCol:h,wrapperCol:p};let T=d||f;const K={...I,...h},L={...E,...p};return T&&(T=Te(T)?`${T}px`:T),{labelCol:{style:{width:T},...K},wrapperCol:{style:{width:y==="vertical"?"100%":`calc(100% - ${T})`},...L}}})}function Gt(e){return e.includes("Input")||e.includes("Complete")?"Please enter":e.includes("Picker")||e.includes("Select")||e.includes("Cascader")||e.includes("Checkbox")||e.includes("Radio")||e.includes("Switch")?"Please choose":""}function Zt(e,n,l){["DatePicker","MonthPicker","WeekPicker","TimePicker"].includes(n)?e.type=l?"string":"object":["RangePicker","Upload","CheckboxGroup","TimePicker"].includes(n)?e.type="array":["InputNumber"].includes(n)&&(e.type="number")}function ae(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ue(e)}const Qt={props:Le,setup(e,{slots:n}){const{schema:l,formProps:h}=We(e),p=Y({}),d=N(()=>{const{allDefaultValues:m,formModel:t,schema:c}=e;return{field:c.field,model:t,values:{...m,...t},schema:c}});N(()=>({...e,...s(p)}));const P=Jt(l,h),f=N(()=>{var o;const{schema:m,formModel:t,formActionType:c}=e;let{componentProps:i={}}=m;return D(i)&&(i=(o=i({schema:m,formActionType:c,formModel:t}))!=null?o:{}),m.component==="Divider"&&(i=Object.assign({type:"horizontal"},i,{orientation:"left",plain:!0})),i});function I(){const{show:m,ifShow:t}=e.schema,c=!1;let i=!0,o=!0;return re(m)&&(i=m),re(t)&&(o=t),D(m)&&(i=m(s(d))),D(t)&&(o=t(s(d))),i=i&&c,{isShow:i,isIfShow:o}}function E(){var F;const{rules:m=[],component:t,label:c,dynamicRules:i,required:o}=e.schema;if(D(i))return i(s(d));let a=z(m);const v=Gt(t);function A(S,R){const j=S.message||v;return R===void 0||_t(R)||Array.isArray(R)&&R.length===0||typeof R=="string"&&R.trim()===""||typeof R=="object"&&Reflect.has(R,"checked")&&Reflect.has(R,"halfChecked")&&Array.isArray(R.checked)&&Array.isArray(R.halfChecked)&&R.checked.length===0&&R.halfChecked.length===0?Promise.reject(j):Promise.resolve()}const _=D(o)?o(s(d)):o;_&&(!a||a.length===0?a=[{required:_,validator:A}]:a.findIndex(R=>Reflect.has(R,"required"))===-1&&a.push({required:_,validator:A}));const B=a.findIndex(S=>Reflect.has(S,"required")&&!Reflect.has(S,"validator"));if(B!==-1){const S=a[B],{isShow:R}=I();if(R||(S.required=!1),t){Reflect.has(S,"type")||(S.type=t==="InputNumber"?"number":"string"),S.message=S.message||v,(t.includes("Input")||t.includes("Textarea"))&&(S.whitespace=!0);const j=(F=s(f))==null?void 0:F.valueFormat;Zt(S,t,j)}}const V=a.findIndex(S=>S.max);return V!==-1&&!a[V].validator&&(a[V].message=a[V].message||"The number of characters should be less than "+[a[V].max]),a}function y(){const{component:m,field:t,changeEvent:c="change",placeholder:i,renderComponentContent:o}=e.schema,{size:a,disabled:v}=e.formProps,A={allowClear:!0,size:a,...s(f),disabled:!!v},_=N(()=>{const{formModel:k,schema:W,allDefaultValues:O}=e;return{field:W.field,model:k,values:{...k,...O},schema:W}});A.disabled,A.codeField=t,A.formValues=s(_),A.placeholder=i;const B=m&&["Switch","Checkbox"].includes(m),V=ze.get(m),F=`on${Dt(c)}`,S={[F]:(...k)=>{const[W]=k;A[F]&&A[F](...k);const O=W?W.target:null,G=O?B?O.checked:O.value:W;e.setFormModel(t,G)}},R={[B?"checked":"value"]:e.formModel[t]},j={...A,...S,...R};if(o){const k=D(o)?{...o(s(_))}:{default:()=>o};return x(V,j,ae(k)?k:{default:()=>[k]})}else return x(V,j,null)}function T(){const{label:m,helpMessage:t,helpComponentProps:c,subLabel:i}=e.schema,o=i?x("span",null,[m,He(" "),x("span",{class:"text-secondary"},[i])]):m,a=D(t)?t(s(d)):t;return!a||Array.isArray(a)&&a.length===0?o:x("span",null,[o,x(Ye,Pe({placement:"top",class:"mx-1",text:a},c),null)])}function K(){const{field:m,component:t,label:c,show:i,required:o,slot:a,render:v,suffix:A}=e.schema,{colon:_}=e.formProps,{labelCol:B,wrapperCol:V}=s(P);if(t==="Divider"){let F;return x(ge,{span:24},{default:()=>[x(Ke,s(f),ae(F=T())?F:{default:()=>[F]})]})}else{const F=()=>a?Yt(n,a,s(d)):v?v(s(d)):y(),S=!!A,R=D(A)?A(s(d)):A;return x(Ce.Item,{name:m,colon:_,class:{"suffix-item":S},label:T(),rules:E(),labelCol:B,required:o,wrapperCol:V},{default:()=>[x("div",{style:"display:flex"},[x("div",{style:"flex:1;"},[F()]),S&&x("span",{class:"suffix"},[R])])]})}}const{show:L}=e.schema,M=!(re(L)&&L===!1);return()=>{let m;return M&&x(ge,{class:"ant-col-24"},ae(m=K())?m:{default:()=>[m]})}}},tn=Je({__name:"NantaForm",props:Ge,emits:["register","field-value-change","reset","submit"],setup(e,{emit:n}){const l=e,h=Ze(),p=Y({}),d=Y(null),P=Y(null),f=Qe({}),I=Y({}),E=Y(!1),y=N(()=>({...l,...s(p)})),T=N(()=>{const{baseRowStyle:r={},rowProps:u}=s(y);return{style:r,...u}}),K={resetAction:W,submitAction:k},L=N(()=>({...y.value,...K})),M=N(()=>{const r=s(d)||s(y).schemas;for(const b of r);return z(r)}),m=N(()=>({...h,...l,...s(y)}));async function t(r){p.value=ye(s(p)||{},r)}const{updateSchema:c,resetSchema:i,appendSchemaByField:o,removeSchemaByFiled:a,scrollToField:v}=zt({getProps:y,formModel:f,getSchema:M,defaultValueRef:I,formElRef:P,schemaRef:d,handleFormValues:O,getFieldsValue:A,setFieldsValue:B});function A(){return s(P)?O(pe(s(f))):{}}async function _(){const{resetFn:r}=s(y);if(r&&D(r)){await r();return}!s(P)||(Object.keys(f).forEach(b=>{const C=s(M).find(g=>g.field===b),w=(C==null?void 0:C.component)&&Ht.includes(C.component),$=z(I.value[b]);f[b]=w?$||"":$}),n("reset",pe(f)))}async function B(r){const u=s(M).map(w=>w.field).filter(Boolean),b=".";u.filter(w=>w.includes(b));const C=[];Object.keys(r).forEach(w=>{const $=s(M).find(q=>q.field===w);let g=r[w];const H=Reflect.has(r,w);if(g=jt($==null?void 0:$.component,g),H&&u.includes(w)){if(Lt($==null?void 0:$.component))if(Array.isArray(g)){const q=[];for(const Z of g)q.push(Z?ce(Z):null);f[w]=q}else f[w]=g||null;else f[w]=g;C.push(w)}}),V(C).catch(w=>{})}async function V(r){var u;return(u=s(P))==null?void 0:u.validateFields(r)}async function F(r){var u;return await((u=s(P))==null?void 0:u.validate(r))}async function S(r){var u;await((u=s(P))==null?void 0:u.clearValidate(r))}function R(r,u){f[r]=u,n("field-value-change",r,u)}function j(r){const{autoSubmitOnEnter:u}=s(y);if(!!u&&r.key==="Enter"&&r.target&&r.target instanceof HTMLElement){const b=r.target;b&&b.tagName&&b.tagName.toUpperCase()=="INPUT"&&k()}}async function k(r){r&&r.preventDefault();const{submitFn:u}=s(y);if(u&&D(u)){await u();return}if(!!s(P))try{const C=await F(),w=O(C);n("submit",w)}catch(C){throw new Error(C)}}async function W(r){r&&r.preventDefault(),_()}function O(r){var C,w;if(!U(r))return{};const u={};for(const $ of Object.entries(r)){let[,g]=$;const[H]=$;if(!H||J(g)&&g.length===0||D(g))continue;const q=s(y).transformDateFunc;U(g)&&(g=q==null?void 0:q(g)),J(g)&&((C=g[0])==null?void 0:C.format)&&((w=g[1])==null?void 0:w.format)&&(g=g.map(Z=>q==null?void 0:q(Z))),ne(g)&&(g=g.trim()),!Wt(H,g,u)&&!Ut(H,g,u)&&fe(u,H,g)}const b=s(y).fieldMapToTime;return Kt(u,b)}de(()=>s(y).model,()=>{const{model:r}=s(y);!r||B(r)},{immediate:!0}),de(()=>M.value,r=>{st(()=>{}),!s(E)&&r!=null&&r.length&&(G(),E.value=!0)});function G(){const r=s(M),u={};r.forEach(b=>{const{defaultValue:C}=b;Re(C)||(u[b.field]=C,f[b.field]===void 0&&(f[b.field]=C))}),I.value=z(u)}const ue={getFieldsValue:A,setFieldsValue:B,resetFields:_,updateSchema:c,resetSchema:i,removeSchemaByFiled:a,appendSchemaByField:o,setProps:t,clearValidate:S,validateFields:V,validate:F,submit:k,scrollToField:v};return Xe(()=>{G(),n("register",ue)}),(r,u)=>(se(),me(s(Ce),Pe(s(m),{ref_key:"formElRef",ref:P,model:f,onKeypress:rt(j,["enter"])}),{default:Q(()=>[x(s(Mt),ee(te(s(T))),{default:Q(()=>[X(r.$slots,"formHeader"),(se(!0),et(tt,null,oe(s(M),b=>(se(),me(Qt,{key:b.field,schema:b,"form-props":s(y),"form-model":f,"set-form-model":R,"all-default-values":I.value,formActionType:ue},he({_:2},[oe(Object.keys(r.$slots),C=>({name:C,fn:Q(w=>[X(r.$slots,C,ee(te(w||{})))])}))]),1032,["schema","form-props","form-model","all-default-values"]))),128)),x(nt,ee(te(s(L))),he({_:2},[oe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],b=>({name:b,fn:Q(C=>[X(r.$slots,b,ee(te(C||{})))])}))]),1040),X(r.$slots,"formFooter")]),_:3},16)]),_:3},16,["model","onKeypress"]))}});export{tn as _};
